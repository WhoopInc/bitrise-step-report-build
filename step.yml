#
# A couple of useful guides & docs:
#
# - Main Bitrise CLI docs: https://github.com/bitrise-io/bitrise/tree/master/_docs
# - Step Development Guideline: https://github.com/bitrise-io/bitrise/blob/master/_docs/step-development-guideline.md
# - Bitrise.yml format spec: https://github.com/bitrise-io/bitrise/blob/master/_docs/bitrise-yml-format-spec.md
# - Bitrise docs: http://devcenter.bitrise.io/
# - Bitrise CLI guides: http://devcenter.bitrise.io/bitrise-cli/

title: |-
  report-build
summary: |
  Bitrise step that reports build info to EZDeploy
description: |
  Reports build info to dev and prod EZDeploy.
website: https://github.com/WhoopInc/bitrise-step-report-build
source_code_url: https://github.com/WhoopInc/bitrise-step-report-build
support_url: https://github.com/WhoopInc/bitrise-step-report-build/issues
host_os_tags:
  - osx-10.10
  - ubuntu-16.04
project_type_tags:
  - android
  - ios

type_tags:
  - utility

is_requires_admin_user: false
is_always_run: true
is_skippable: true

toolkit:
  bash:
    entry_file: step.sh

inputs:
  - url:
    opts:
      title: "EZDeploy API endpoint"
      summary: |-
        Specifies the endpoint to send the Bitrise build info to
      is_required: true
  - started_at: $STARTED_AT
    opts:
      title: "Time build started at"
      summary: |-
        The time the build started at, in the format "%Y-%m-%dT%H:%M:%S.%3N%z"
      is_required: true
  - completed_at: $COMPLETED_AT
    opts:
      title: "Time build completed at"
      summary: |-
        The time the build completed at, in the format "%Y-%m-%dT%H:%M:%S.%3N%z"
      is_required: true
  - total_duration: $TOTAL_DURATION
    opts:
      title: "Build duration in ms"
      summary: |-
        (time completed at - time started at) in milliseconds
      is_required: true
  - repository: $BITRISEIO_GIT_REPOSITORY_SLUG
    opts:
      title: "Github repository associated with build"
      is_expand: true
      is_required: true
  - branch: $BITRISE_GIT_BRANCH
    opts:
      title: "Github branch associated with build"
      is_expand: true
      is_required: true
  - build_num: $BITRISE_BUILD_NUMBER
    opts:
      title: "Build number associated with build"
      is_expand: true
      is_required: true
  - commit_sha: $BITRISE_GIT_COMMIT
    opts:
      title: "Hash for commit that triggered build"
      is_expand: true
      is_required: true
  - status: $BITRISE_BUILD_STATUS
    opts:
      title: "Result of build - can be either (0 - successful, 1 - failed)"
      is_expand: true
      is_required: true
  - build_url: $BITRISE_BUILD_URL
    opts:
      title: "URL on bitrise.io that shows build details"
      is_expand: true
      is_required: true
  - github_username: $GIT_CLONE_COMMIT_AUTHOR_NAME
    opts:
      title: "Github username linked with committer"
      is_expand: true
      is_required: true
  - message: $BITRISE_GIT_MESSAGE
    opts:
      title: "The commit message, PR title or manual trigger message"
      is_expand: true
      is_required: true
  - auth_token: $EZDEPLOY_AUTH_TOKEN
    opts:
      title: "Token used to authenticate with EZDeploy"
      sensitive: true
      is_expand: true
      is_required: true
